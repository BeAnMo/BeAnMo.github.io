<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Middleware for useReducer</title><link href="https://fonts.googleapis.com/css2?family=Merriweather&family=Montserrat:wght@500&family=Source+Code+Pro&display=swap" rel="stylesheet"><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"><style>body{margin:0;padding:0;font-size:1.1rem;font-weight:500;font-family:Merriweather,serif;background-color:#fbfbfb;color:#444}h1,h2,h3,h4,h5,h6{font-family:Montserrat,-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;margin:1rem 0}p{margin:1rem 0}pre{background-color:#eee;padding:.5rem;width:100%;overflow:auto;line-height:1rem}code{font-family:Source Code Pro,monospace;color:#00a19c}a{color:#0083c1}a:hover{color:#00a19c}a:active{color:#f98e2c}a:visited{color:#ce112d}</style><link rel="stylesheet" href="/assets/css/main.css"><link rel="stylesheet" href="/assets/css/prism-theme.css"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-178156821-2"></script><script>window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', 'UA-178156821-2');</script></head><body><nav class="navbar"><h3><a href="/#about-me">Benjamin Morin</a></h3><div class="navbar-links"></div></nav><main class="container"><article class="content"><header><h1 style="margin-bottom: 0;">Middleware for useReducer</h1><h5 style="margin-top: 0;" class="lt-text">Sun Nov 01 2020</h5></header><section><div class="post-body"><img src="/assets/images/construction.gif" alt="Under construction"><p>One of the great things about <a href="https://redux.js.org/" target="_blank" rel="noopener">Redux</a> is the ability to extend the functionality of the dispath function with middleware. When action gets dispatched somewhere in an app, it will call reducer (but doesn't have to), and update the state. The middleware lives between dispatching the action and calling the reducer. Here an action can be blocked, duplicated, branched into multiple other actions. There's enormous possibility, but it's not always appropriate to rely on global state management. It often makes sense to keep state local to a component.</p><p>Fortunately, there's the <code>useReducer</code> hook. It follows a similar pattern to Redux: dispatch an action, call a reducer, then update the state. Turns out that just like Redux, <code>useReducer</code> can also accept middleware to extend functionality. <strong>Why use middleware/reducers at all????</strong></p><p>There's a hook base on <code>useReducer</code> in <a href="/posts/2020/use-api-state">useApiState Hook</a> that provides the perfect opportunity to improve.</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token constant">INITIAL_STATE</span> <span class="token operator">=</span> <span class="token punctuation">{</span><br>  error<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><br>  loading<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>  data<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token comment">// Actions</span><br><span class="token keyword">const</span> <span class="token constant">FETCH</span> <span class="token operator">=</span> <span class="token string">"FETCH"</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> <span class="token constant">FAILURE</span> <span class="token operator">=</span> <span class="token string">"FAILURE"</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> <span class="token constant">SUCCESS</span> <span class="token operator">=</span> <span class="token string">"SUCCESS"</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">case</span> <span class="token constant">FETCH</span><span class="token operator">:</span><br>      <span class="token keyword">return</span> <span class="token punctuation">{</span><br>        error<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><br>        loading<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>        data<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><br>      <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">case</span> <span class="token constant">FAILURE</span><span class="token operator">:</span><br>      <span class="token keyword">return</span> <span class="token punctuation">{</span><br>        data<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><br>        loading<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>        error<span class="token operator">:</span> action<span class="token punctuation">.</span>error<span class="token punctuation">,</span><br>      <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">case</span> <span class="token constant">SUCCESS</span><span class="token operator">:</span><br>      <span class="token keyword">return</span> <span class="token punctuation">{</span><br>        error<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><br>        loading<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>        data<span class="token operator">:</span> action<span class="token punctuation">.</span>data<span class="token punctuation">,</span><br>      <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">default</span><span class="token operator">:</span><br>      <span class="token keyword">return</span> state<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token comment">/**<br> * @param {(args: ...any) => Promise&lt;any>} caller<br> * @param {{ error?: any, loading?: boolean, data?: any }=} initialState<br> *<br> * @param {[{ error: any, loading: boolean, data: any }, (args: ...any) => void]}<br> */</span><br><span class="token keyword">const</span> <span class="token function-variable function">useApiState</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">caller<span class="token punctuation">,</span> initialState <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token punctuation">{</span><br>    <span class="token operator">...</span><span class="token constant">INITIAL_STATE</span><span class="token punctuation">,</span><br>    <span class="token operator">...</span>initialState<span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">return</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token constant">FETCH</span><span class="token punctuation">,</span> args <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>That's the basic middleware-less setup. Currently, dispatching <code>FETCH</code> does nothing but trigger the loading value (assuming that it was not set in <code>initialState</code>). There is no way to advance to <code>SUCCESS</code> or <code>FAILURE</code> states. The actual dispatch function could be provided to a hook consumer instead of just a wrapped <code>FETCH</code>, but that defeats the purpose of <code>useApiState</code>; to hide management of response states from the consumer. However, for developer convenience and flexibility, <code>dispatch</code> will be returned as the third element of the array.</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">useApiState</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">caller<span class="token punctuation">,</span> initialState <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token comment">// ...</span><br><br>  <span class="token keyword">return</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token constant">FETCH</span><span class="token punctuation">,</span> args <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>That still does not solve the problem of the automatically managing response states. When <code>FETCH</code> is encountered, <code>caller</code> should be called with the <code>args</code> provided by the action. This is expected to be an asynchronous operation. If it succeededs, a <code>SUCCESS</code> needs to be dispatched with the response data, otherwise it should dispatch a <code>FAILURE</code> with the error.</p><p>The dispatching can be intercepted with middleware, providing the automatic management needed to achieve the goal of <code>useApiState</code>. Those requirements turn into this middleware.</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">fetcher</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">caller</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token parameter">dispatch</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token comment">// Ensure that the current action is dispatched.</span><br>  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">dispatch</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token constant">FETCH</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token function">caller</span><span class="token punctuation">(</span><span class="token operator">...</span>action<span class="token punctuation">.</span>args<span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token constant">SUCCESS</span><span class="token punctuation">,</span> data <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token constant">FAILURE</span><span class="token punctuation">,</span> error <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">return</span> result<span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>The curried function signature takes a few seconds to fully sink in. <code>caller</code> is the async function passed to <code>useApiState</code> initially. The function returned then takes <code>dispatch</code> calls it <code>action</code>.</p><p>In <code>fetcher</code> each action encountered is passed through to the next dispatch. When <code>FETCH</code> is encountered, it will also call the reducer with <code>SUCCESS</code> or <code>FAILURE</code> depending on <code>caller</code>'s result.</p><p>The revised <code>useApiState</code> wraps <code>dispatch</code> in <code>fetchMiddleware</code>.</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">useApiState</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">caller<span class="token punctuation">,</span> initialState <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token punctuation">{</span><br>    <span class="token operator">...</span><span class="token constant">INITIAL_STATE</span><span class="token punctuation">,</span><br>    <span class="token operator">...</span>initialState<span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> enhancedDispatch <span class="token operator">=</span> <span class="token function">fetcher</span><span class="token punctuation">(</span>caller<span class="token punctuation">)</span><span class="token punctuation">(</span>dispatch<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">return</span> <span class="token punctuation">[</span><br>    state<span class="token punctuation">,</span><br>    <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">enhancedDispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token constant">FETCH</span><span class="token punctuation">,</span> args <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    enhancedDispatch<span class="token punctuation">,</span><br>  <span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>The is simple and effective enough for the given use case, but there's a key problem. As stated, <code>dispatch</code> only refers to the next dispatch function in the middleware chain. At the moment, that's <code>reducer</code>. What if the component using the hook needed to log actions for development purposes?</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">logger</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">dispatch</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Dispatching: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>action<span class="token punctuation">.</span>type<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">return</span> <span class="token function">dispatch</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>Borrowing from part of structure of <code>fetcher</code>, <code>logger</code> logs the given action and then dispatches it. That's helpful, but unfortunately there's no detailed knowledge of the state transition the action is reponsible for (if any). Moreover, it requires a reconfiguring of <code>useApiState</code>. The middleware should not be hard coded to the hook (except for <code>fetcher</code>), because maybe logging to <code>console</code> is appropriate for development but not production.</p><p>To help compose dispatch with arbitrary middleware, <code>pipe</code> helps out by applying a list of functions to the initial argument. <code>pipe(x, h, g, f)</code> is equivalent to <code>f(g(h(x)))</code>.</p><pre class="language-js"><code class="language-js"><span class="token comment">/**<br> * @param {any} src<br> * @param {...Function} procedures<br> *<br> * @return {any}<br> */</span><br><span class="token keyword">const</span> <span class="token function-variable function">pipe</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">src<span class="token punctuation">,</span> <span class="token operator">...</span>procedures</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> procedures<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">acc<span class="token punctuation">,</span> procedure</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">procedure</span><span class="token punctuation">(</span>acc<span class="token punctuation">)</span><span class="token punctuation">,</span> src<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>Now <code>useApiState</code> can use any middleware provided they follow the signature of <code>dispatch =&gt; action</code>.</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">useApiState</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">caller<span class="token punctuation">,</span> initialState <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> middleware <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token punctuation">{</span><br>    <span class="token operator">...</span><span class="token constant">INITIAL_STATE</span><span class="token punctuation">,</span><br>    <span class="token operator">...</span>initialState<span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> enhancedDispatch <span class="token operator">=</span> <span class="token function">pipe</span><span class="token punctuation">(</span>dispatch<span class="token punctuation">,</span> <span class="token operator">...</span>middleware<span class="token punctuation">,</span> <span class="token function">fetcher</span><span class="token punctuation">(</span>caller<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">return</span> <span class="token punctuation">[</span><br>    state<span class="token punctuation">,</span><br>    <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">enhancedDispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token constant">FETCH</span><span class="token punctuation">,</span> args <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    enhancedDispatch<span class="token punctuation">,</span><br>  <span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>How about a component that fetches data when mounted?</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> middlewares <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">"production"</span> <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">[</span>logger<span class="token punctuation">]</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> <span class="token function-variable function">DataRender</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> error<span class="token punctuation">,</span> loading<span class="token punctuation">,</span> data <span class="token punctuation">}</span><span class="token punctuation">,</span> dispatchFetch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useApiState</span><span class="token punctuation">(</span><br>    fetchData<span class="token punctuation">,</span><br>    <span class="token punctuation">{</span><br>      loading<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    middlewares<br>  <span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token function">dispatchFetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token punctuation">{</span>error<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>loading<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token operator">&lt;</span>p<span class="token operator">></span>Loading<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">// ...render something with the data</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>As expected, when the component is mounted it will only render <code>&lt;p&gt;Loading...&lt;/p&gt;</code>.</p><hr><p>remainder</p><ul><li>set up RecentActivities from useapistate post</li><li>show how/why existing middleware signatures don't work</li><li>explain actual redux middleware signature</li><li>rebuild useApiState with actual middleware signature</li></ul><hr><ul><li>extend <code>useApiState</code> example</li><li>explain redux middleware signature<ul><li><code>store =&gt; next =&gt; action</code></li><li>store is current store state</li><li>next is next middleware in the middleware chain (think <code>nextDispatch</code>)</li><li>action is the current action</li><li>using <code>store.dispatch</code> to dispatch will send new action through entire middleware chain</li><li><code>next</code> will only dispatch action to next middleware</li></ul></li><li>example middleware<ul><li>logging</li><li>caching</li><li>paging</li></ul></li></ul></div></section></article></main><footer class="container" style="height: 4rem;"><div class="content" style="display: flex; justify-content: space-between; align-items: baseline;"><a href="/">Back Home</a><h5 style="align-self: flex-end;">&copy; 2020 Benjamin Morin</h5></div></footer></body></html>